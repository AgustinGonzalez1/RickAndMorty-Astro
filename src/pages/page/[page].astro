---
import Layout from "../../layouts/Layout.astro";
import type { Character } from "../../types/types";

const { page } = Astro.params;

const response = await fetch(`https://rickandmortyapi.com/api/character?page=${page}`);

const data = await response.json();

export const getStaticPaths = async () => {
	const response = await fetch("https://rickandmortyapi.com/api/character");

	const data = await response.json();

	const totalPages = data.info.pages;

	const paths = Array.from({ length: totalPages }, (_, index) => ({
		params: { page: (index + 1).toString() },
	}));

	return paths;
};
---

<Layout title=`Page ${page}`>
	<section class="container mx-auto">
		<h1 class="text-4xl text-center py-4">Rick and Morty Characters</h1>

		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
			{
				data.results.map((character: Character) => (
					<a href={`/characters/${character.id}`} class="rounded-2xl border-2 border-[#8c90a5]">
						<article class="flex flex-col p-4 gap-4 text-[#8c90a5]">
							<div class="w-full flex justify-end">
								<p>id: {character.id}</p>
							</div>
							<img src={character.image} alt={character.name} class="rounded-xl" transition:name={`card-${character.id}`} />
							<h2>{character.name}</h2>
						</article>
					</a>
				))
			}
		</div>
	</section>
</Layout>
